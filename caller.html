<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Caller</title>

<style>
body {
    font-family: Arial;
    background: linear-gradient(to right,#eca1a6,#d5f4e6);
    text-align:center;
    padding:20px;
}

table {
    border-collapse:collapse;
    margin:auto;
    background:white;
    border-radius:10px;
    box-shadow:0 6px 15px rgba(0,0,0,0.1);
}

td,th {
    border:1px solid #ddd;
    padding:10px;
    width:40px;
}

.picked {
    background:#b6e2ff;
}

.button-container {
    margin-top:20px;
}

button {
    padding:10px 20px;
    margin:5px;
    border:none;
    border-radius:6px;
    cursor:pointer;
    font-size:16px;
}

.play { background:#4CAF50; color:white; }
.pause { background:#f44336; color:white; }
.speed { background:#2196F3; color:white; }

#numberDisplayWrapper {
    text-align: center;
    font-size: 34px;
    margin-bottom: 20px;
}

#previousNumbers {
    color: rgba(0,0,0,0.45); /* faded black */
    font-weight: 400;
    letter-spacing: 1px;
}

#randomNumberDisplay {
    color: #e91e63;
    font-weight: 700;
    font-size: 42px;
    margin-left: 5px;
}


</style>
</head>

<body>

<!-- SAME LINE DISPLAY -->
<div id="numberDisplayWrapper">
    <span id="previousNumbers"></span>
    <span id="randomNumberDisplay"></span>
</div>

<table id="numberTable">
<tr><th colspan="10">Tambola Numbers</th></tr>
</table>

<div class="button-container">
<button id="playPauseBtn" class="play">▶ Play</button>
<button id="speedBtn" class="speed">Speed: Normal</button>
<button onclick="restartGame()">Restart</button>
</div>

<script>

let table=document.getElementById("numberTable");

// Build board
for(let i=1;i<=9;i++){
    let row=table.insertRow();
    for(let j=1;j<=10;j++){
        let cell=row.insertCell();
        let num=(i-1)*10+j;
        cell.textContent=num;
        cell.dataset.number=num;
    }
}

let numbers=[];
let index=0;
let isPlaying=false;
let delayBetweenNumbers=1500;
let timeoutId=null;
let previousNumbers=[];

const ones=["Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine"];
const tensNames=["","Ten","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"];

function getFunCall(num){

    if(num<10){
        return "Only number "+ones[num]+"!";
    }

    let tens=Math.floor(num/10);
    let unit=num%10;

    if(tens===unit){
        return ones[tens]+" "+ones[unit]+" – "+num+"!";
    }

    if(unit===0){
        return ones[tens]+" Zero – "+tensNames[tens]+"!";
    }

    return ones[tens]+" "+ones[unit]+" – "+num+"!";
}

function initGame(){
    numbers=[...Array(90).keys()].map(x=>x+1)
        .sort(()=>Math.random()-0.5);
    index=0;
    isPlaying=false;
    speechSynthesis.cancel();
}

initGame();

function callNextNumber(){

    if(!isPlaying) return;

    if(index>=numbers.length){
        isPlaying=false;
        btn.textContent="▶ Play";
        btn.className="play";
        return;
    }

    let num=numbers[index++];

    previousNumbers.push(num);

    if(previousNumbers.length>3){
        previousNumbers.shift();
    }

    let prevDisplay=previousNumbers.slice(0,-1);

    document.getElementById("previousNumbers").textContent =
        prevDisplay.length>0 ? prevDisplay.join(", ") +",": "";

    document.getElementById("randomNumberDisplay").textContent = num;

    document.querySelectorAll('td[data-number="'+num+'"]')
        .forEach(c=>c.classList.add("picked"));

    speechSynthesis.cancel();

    let textToSpeak=getFunCall(num);

    let utter=new SpeechSynthesisUtterance(textToSpeak);
    utter.volume = 1; utter.rate = 0.85; utter.pitch = 1;

    utter.onend=function(){
        timeoutId=setTimeout(callNextNumber,delayBetweenNumbers);
    };

    speechSynthesis.speak(utter);
}

function togglePlay(){
    if(isPlaying){
        isPlaying=false;
        speechSynthesis.cancel();
        clearTimeout(timeoutId);
        btn.textContent="▶ Play";
        btn.className="play";
    }else{
        isPlaying=true;
        btn.textContent="⏸ Pause";
        btn.className="pause";
        callNextNumber();
    }
}

function changeSpeed(){
    if(delayBetweenNumbers===1500){
        delayBetweenNumbers=600;
        speedBtn.textContent="Speed: Fast";
    }else{
        delayBetweenNumbers=1500;
        speedBtn.textContent="Speed: Normal";
    }
}

function restartGame(){

    let confirmReset=confirm("Are you sure you want to restart the game?");
    if(!confirmReset) return;

    isPlaying=false;
    speechSynthesis.cancel();
    clearTimeout(timeoutId);

    document.querySelectorAll(".picked")
        .forEach(cell=>cell.classList.remove("picked"));

    document.getElementById("randomNumberDisplay").textContent="";
    document.getElementById("previousNumbers").textContent="";
    previousNumbers=[];

    initGame();

    btn.textContent="▶ Play";
    btn.className="play";
}

let btn=document.getElementById("playPauseBtn");
let speedBtn=document.getElementById("speedBtn");

btn.onclick=togglePlay;
speedBtn.onclick=changeSpeed;

</script>

</body>
</html>
