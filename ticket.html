<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tambola Ticket</title>

<style>
body {
    font-family: Arial;
    background: linear-gradient(to right,#eca1a6,#d5f4e6);
    padding:20px;
    text-align:center;
}

.radio-container {
    margin-bottom:15px;
}

table {
    border-collapse:separate;
    border-spacing:4px;
    margin:15px auto;
    background:white;
    border-radius:10px;
    box-shadow:0 6px 15px rgba(0,0,0,0.1);
}

th,td {
    border:1px solid black;
    padding:12px;
    width:50px;
    font-weight:bold;
}

.selected {
    background:#ffcccb;
}

button {
    padding:10px 25px;
    margin:10px;
    border:none;
    border-radius:6px;
    background:#4CAF50;
    color:white;
    cursor:pointer;
}

button:hover {
    background:#45a049;
}
</style>
</head>

<body>

<div class="radio-container">
    <label><input type="radio" name="sections" value="1" checked> 1 Ticket</label>
    <label><input type="radio" name="sections" value="2"> 2 Tickets</label>
</div>

<button onclick="generateTickets()">Generate Ticket</button>

<div id="ticketContainer"></div>

<script>
function getColumnRange(col){
    if(col===0) return [1,9];
    if(col===8) return [80,90];
    return [col*10, col*10+9];
}

function shuffle(arr){
    return arr.sort(()=>Math.random()-0.5);
}

function generateSingleTicket(){
    let ticket = Array.from({length:3},()=>Array(9).fill(null));
    let columnCounts = Array(9).fill(1);
    let remaining = 15 - 9;

    // Distribute remaining safely
    while(remaining>0){
        let col=Math.floor(Math.random()*9);
        if(columnCounts[col]<3){
            columnCounts[col]++;
            remaining--;
        }
    }

    let rowCounts = [0,0,0];

    for(let col=0; col<9; col++){

        let [start,end]=getColumnRange(col);
        let nums=[];
        for(let i=start;i<=end;i++) nums.push(i);
        shuffle(nums);

        let selected = nums.slice(0,columnCounts[col]).sort((a,b)=>a-b);

        selected.forEach(num=>{
            // Find valid rows
            let validRows=[];
            for(let r=0;r<3;r++){
                if(rowCounts[r]<5 && ticket[r][col]===null){
                    validRows.push(r);
                }
            }

            if(validRows.length>0){
                let chosenRow = validRows[Math.floor(Math.random()*validRows.length)];
                ticket[chosenRow][col]=num;
                rowCounts[chosenRow]++;
            }
        });
    }

    return ticket;
}

function renderTicket(ticket){
    let table=document.createElement("table");

    let thead=document.createElement("thead");
    let tr=document.createElement("tr");
    let th=document.createElement("th");
    th.colSpan=9;
    th.textContent="Tambola Ticket";
    tr.appendChild(th);
    thead.appendChild(tr);
    table.appendChild(thead);

    let tbody=document.createElement("tbody");

    ticket.forEach(rowData=>{
        let row=document.createElement("tr");
        rowData.forEach(cellData=>{
            let cell=document.createElement("td");
            if(cellData!==null){
                cell.textContent=cellData;
                cell.onclick=()=>cell.classList.toggle("selected");
            }
            row.appendChild(cell);
        });
        tbody.appendChild(row);
    });

    table.appendChild(tbody);
    return table;
}

function generateTickets(){
    let container=document.getElementById("ticketContainer");
    container.innerHTML="";

    let sections=document.querySelector('input[name="sections"]:checked').value;

    for(let i=0;i<sections;i++){
        let ticket=generateSingleTicket();
        container.appendChild(renderTicket(ticket));
    }
}
</script>

</body>
</html>
